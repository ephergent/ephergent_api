[Unit]
Description=Gunicorn instance to serve Ephergent API
# Start after the network is available
After=network.target

[Service]
# User and Group that will run the service
# Create this user/group if it doesn't exist:
# sudo useradd -r -s /bin/false ephergent
# sudo groupadd ephergent
# sudo usermod -a -G ephergent ephergent
User=ephergent
Group=ephergent

# Set the working directory
WorkingDirectory=/srv/ephergent_api

# Load environment variables from the .env file
# Ensure this file exists and has correct permissions (readable by the User/Group)
EnvironmentFile=/srv/ephergent_api/.env

# Command to execute
# Runs Gunicorn from the virtual environment
# Binds to localhost:8000 (for Nginx proxy)
# Specifies the number of workers (adjust as needed based on CPU cores)
# Specifies the WSGI application entry point (app:create_app('prod'))
ExecStart=/srv/ephergent_api/venv/bin/gunicorn --workers 3 --bind 127.0.0.1:8000 "app:create_app('prod')"

# Restart the service if it fails
Restart=on-failure

# Standard output and error logging configuration
# 'journal' sends stdout to the systemd journal
# 'syslog' sends stdout to syslog
StandardOutput=journal
StandardError=journal

# Identifier for syslog messages
SyslogIdentifier=ephergent-api

[Install]
# Enable the service for multi-user target (standard runlevel)
WantedBy=multi-user.target
